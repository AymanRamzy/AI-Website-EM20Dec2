ğŸ§± Tasks (Do All â€” No Partial Completion)
1ï¸âƒ£ Backend â€” Competition Registration API

Create or fix endpoint:

POST /api/competitions/:competition_id/register


Logic must:

Require authenticated user

Validate competition exists

Validate competition.status === 'open'

Prevent duplicate registration

Insert registration row

Return clear JSON response

Return example:

{ "success": true }


Failure cases must return meaningful errors (not generic 500s).

2ï¸âƒ£ Database â€” Minimal Registration Table

If missing, create a single simple table:

competition_registrations (
  id uuid primary key default gen_random_uuid(),
  competition_id uuid references competitions(id),
  user_id uuid references auth.users(id),
  created_at timestamptz default now(),
  unique (competition_id, user_id)
)


No extra columns unless required.

3ï¸âƒ£ Backend â€” Service Role Usage

Use SUPABASE_SERVICE_ROLE_KEY ONLY in backend

Never expose service role to frontend

Enforce RLS properly (service role bypass OK)

4ï¸âƒ£ Frontend â€” Registration Flow

Update frontend logic so that:

Button calls correct endpoint

Loading state is shown

On success â†’ show confirmation message

On failure â†’ show backend error message

Button disables if already registered

Button disables if competition is not open

5ï¸âƒ£ Frontend â€” Route Integrity

Ensure route exists and works:

/competitions/:competitionId/register


OR handle registration inline on details page (preferred).

No navigation to missing pages.

6ï¸âƒ£ UI State Rules

Competition page must follow this logic:

Condition	Button State
status !== open	Disabled
user not logged in	Redirect to login
already registered	Disabled + label
success	Show confirmation
failure	Show error
7ï¸âƒ£ Error Handling (Mandatory)

Replace all generic failures with:

Specific backend messages

Frontend error banners

No silent failures

No infinite retries

8ï¸âƒ£ Final Verification Checklist (Must Pass)

âœ… Register button works

âœ… One registration per user per competition

âœ… Page reload shows correct state

âœ… No console errors

âœ… No 500 responses

âœ… No broken routes

âœ… No extra features added

ğŸš« Explicit Constraints

Do NOT redesign UI

Do NOT add team logic unless required

Do NOT add admin features

Do NOT refactor unrelated files

Keep solution minimal & production-safe

ğŸ“¦ Deliverables

Working backend endpoint

Correct DB schema

Stable frontend behavior

Short summary of what was fixed